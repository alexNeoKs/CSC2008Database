<!doctype html>

<html lang="en">
    <head>
        <meta charset="utf-8" />
        <link rel="icon" type="image/png" href="../assets/img/favicon.png">
        <link rel="stylesheet" href="{{ url_for('static', filename='styles.css') }}">
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/datatables/1.10.21/css/dataTables.bootstrap.min.css">
        
        <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.4/jquery.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/datatables/1.10.21/js/jquery.dataTables.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/datatables/1.10.21/js/dataTables.bootstrap.min.js"></script>
        <script>        
            async function doSomething()
            {
                try
                {
                    let song      = document.getElementById('songName')
                    let artist    = document.getElementById('artistName')
                    let album     = document.getElementById('albumName')
                    let outputs   = document.getElementById('outputs')

                    let hasSong   = false
                    let hasArtist = false
                    let hasAlbum  = false
                    let inputs    = {}

                    outputs.value = ""
                    //-------------------------------------------------
                    if( song != null && song.value.length > 0 ) 
                    {
                        hasSong = true
                    }
                    if( artist != null && artist.value.length > 0 ) 
                    {
                        hasArtist = true
                    }
                    if( album != null && album.value.length > 0 ) 
                    {
                        hasAlbum = true
                    }

                    //-------------------------------------------------
                    let sqlQuery = ""
                    if( hasSong && hasArtist && hasAlbum )
                    {
                        sqlQuery = ""
                    }
                    else if( hasSong && hasArtist && !hasAlbum )
                    {
                        sqlQuery = ""
                    }
                    else if( hasSong && !hasArtist && hasAlbum )
                    {
                        sqlQuery = ""
                    }
                    else if( !hasSong && hasArtist && hasAlbum )
                    {
                        sqlQuery = ""
                    }
                    else if( hasSong && !hasArtist && !hasAlbum )
                    {
                        inputs = {
                                    'procName' : 'FindArtistsAndAlbumsBySongName',
                                    'args'     : String(song.value)
                                 };
                    }
                    else if( !hasSong && hasArtist && !hasAlbum )
                    {
                        inputs = {
                                   'procName' : 'FindSongsAndAlbumsByArtistName',
                                   'args'     : String(artist.value),
                                 };
                    }
                    else if( !hasSong && !hasArtist && hasAlbum )
                    {
                        inputs = {
                                   'procName' : 'FindSongsAndArtistsByAlbumName',
                                   'args'     : String(album.value),
                                 };
                    }
                    else
                    {
                        sqlQuery = ""
                    }
                    //-------------------------------------------------
                    if( hasSong || hasArtist || hasAlbum )
                    {
                        const request_header = {
                                                    method  : 'POST',
                                                    headers : {
                                                                'Accept'       : 'application/json',
                                                                'Content-Type' : 'application/json',
                                                            },
                                                    body : JSON.stringify( inputs ),
                                               };
                        outputs.value = "Searching please wait.."
                        try
                        {
                            fetch( 'http://localhost:3000/sql/call' , request_header )
                                            .then(  response => response.json() )
                                            .then(  response => {
                                                                    const { results } = response
                                                                    outputs.value = results
                                                                    console.log("results" , results)
                                                                })
                                            .catch( err      => console.log(err) )
                        }
                        catch( err )
                        {
                            console.log( err )
                        }
                    }
                    else
                    {
                        console.log("No inputs")
                    }
                    //-------------------------------------------------
                }
                catch( err )
                {
                    console.log( "Error : " , err )
                }
            }
        </script>
    </head>

    <body>
        <h3>CSC2008 Database project</h3>
        

            <div>
                <div id='inputs'> 
                    <label for='songName'>Song Name</label> 
                    <textarea id='songName' name='songName' wrap="soft" maxlength="255"></textarea>
                    <hr>

                    <label for='artistName'>Artist Name</label> 
                    <textarea id='artistName' name='artistName' wrap="soft" maxlength="255"></textarea>
                    <hr>

                    <label for='albumName'>Album Name</label> 
                    <textarea id='albumName' name='albumName' wrap="soft" maxlength="255"></textarea>
                    <hr>
                    <Button onClick="doSomething()">Search</Button>
                </div>
                <hr>
                <textarea id='outputs'>
                </textarea>
                <hr>

                <table class='table table-striped' id='dt'>
                    <thead>
                        <tr>
                            <td>Song Name</td>
                            <td>Year</td>
                            <td>Disc Number</td>
                            <td>Trac Number</td>
                            <td>Album</td>
                            <td>Artist</td>
                        </tr>
                    </thead>
                    <tbody  id='tb'>
                    </tbody>
                </table>

                <hr>
            </div>

    </body>

</html>